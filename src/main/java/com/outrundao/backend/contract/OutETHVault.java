package com.outrundao.backend.contract;

import io.reactivex.Flowable;
import org.web3j.abi.EventEncoder;
import org.web3j.abi.TypeReference;
import org.web3j.abi.datatypes.Event;
import org.web3j.abi.datatypes.Function;
import org.web3j.abi.datatypes.Type;
import org.web3j.abi.datatypes.generated.Uint256;
import org.web3j.protocol.Web3j;
import org.web3j.protocol.core.DefaultBlockParameter;
import org.web3j.protocol.core.RemoteFunctionCall;
import org.web3j.protocol.core.methods.request.EthFilter;
import org.web3j.protocol.core.methods.response.BaseEventResponse;
import org.web3j.protocol.core.methods.response.Log;
import org.web3j.protocol.core.methods.response.TransactionReceipt;
import org.web3j.tx.Contract;
import org.web3j.tx.TransactionManager;
import org.web3j.tx.gas.ContractGasProvider;

import java.math.BigInteger;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;

@SuppressWarnings("rawtypes")
public class OutETHVault extends Contract {
    public static final String BINARY = "60c0346200021b57601f6200159838819003918201601f19168301926001600160401b0392909183851183861017620002205781608092849260409788528339810103126200021b57620000538162000236565b620000616020830162000236565b906200007d60606200007587860162000236565b940162000236565b936000916001835560018060a01b03938482168015620002035760018054610100600160a81b03198116600895861b610100600160a81b03161790915589519387939291901c83167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08780a316908115620001ed5750600280546001600160a01b031981168317909155875194167f820d8409eb2261e4f28201d3be272689ca6ebdd872f4fb34f71baea6cef203218480a3734300000000000000000000000000000000000002803b15620001e95783600481858094634e606c4760e01b83525af18015620001df57620001b8575b50505060a0526080525161134c90816200024c8239608051818181610637015281816109500152610de6015260a05181818161016e0152818161037d015281816107f20152610f190152f35b8211620001cb575083523880806200016c565b634e487b7160e01b81526041600452602490fd5b86513d84823e3d90fd5b8280fd5b631cbbb84960e31b815260048101849052602490fd5b8851631e4fbdf760e01b815260048101869052602490fd5b600080fd5b634e487b7160e01b600052604160045260246000fd5b51906001600160a01b03821682036200021b5756fe608060409080825260049182361015610023575b505050361561002157600080fd5b005b600091823560e01c908163158ef93e146111b35750806324679d3c1461111357806330d821e914610e8557806336b91f2b14610db75780633b06fcd914610d495780634847cdc814610cfc57806359e741d214610ce057806364e5e3b114610c1357806366ce329a14610beb578063715018a614610b86578063728cdbca146108b1578063787dce3d146108495780637f753de6146108215780638265b121146107de578063884957e61461076f5780638da5cb5b146107435780638f7fe49a146106a457806397d7577614610683578063a5626d2c14610666578063ac866a3214610623578063b0e21e8a14610605578063b5e4a1c4146105dd578063cd2002f5146104b5578063e0232b421461025c578063f2fde38b146101ba5763f3fef3a30361001357346101b657806003193601126101b6576101626111d4565b906001600160a01b03907f0000000000000000000000000000000000000000000000000000000000000000821633036101a757506101a49160243591166112c1565b80f35b51630782484160e21b81528490fd5b5080fd5b508234610258576020366003190112610258576101d56111d4565b6101dd611292565b6001600160a01b0381811693909290841561024257505060018054610100600160a81b03198116600893841b610100600160a81b031617909155901c167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0600080a380f35b51631e4fbdf760e01b8152908101859052602490fd5b8280fd5b508234610258576060366003190112610258576001600160a01b03813581811693908490036104b157602435916044359367ffffffffffffffff8086116104ad57366023870112156104ad57858201359081116104ad5736602482880101116104ad57600288541461049e576002885584158015610496575b6104875787904796828080808a8d5af16102ed611252565b506102fb575b826001815580f35b883b15610258576024608484928489519586948593634963710d60e01b8552338b8601528d828601526060604486015282606486015201848401378181018301859052601f01601f19168101030181838c5af1801561045657610473575b505061271080600654860204906007548602049586824792010111610464578790837f00000000000000000000000000000000000000000000000000000000000000001690846003541690823b156104605786516340c10f1960e01b81526001600160a01b0390921685830190815260208101919091529091839183919082908490829060400103925af1801561045657610436575b50507f134bde118562a60dcf2d8c52965f586e25cf88a371592e44b78c4aa03bcbac849460209493926104239254166112c1565b51908152a28180808080808681806102f3565b610443909594939561121c565b610452578688949293946103ef565b8680fd5b85513d84823e3d90fd5b8380fd5b5082516359c16ac760e01b8152fd5b61047c9061121c565b610452578688610359565b50825163af458c0760e01b8152fd5b5086156102d5565b508251633ee5aeb560e01b8152fd5b8780fd5b8480fd5b50346101b65760209283600319360112610258576104d16111d4565b60025490916001600160a01b039133908316036105c657835163662aa11d60e01b8152309181019182526001600160a01b0384166020830152908690829081906040010381886002604360981b015af19485156105bb579086929195610565575b50907fd68ad86d3ece5caa9dec4dd80d3ced368f81b77895c4c9c4923a5f938748feb9918451938685521692a251908152f35b8281939296503d83116105b4575b61057d8183611230565b810103126105af57519284907fd68ad86d3ece5caa9dec4dd80d3ced368f81b77895c4c9c4923a5f938748feb9610532565b600080fd5b503d610573565b8451903d90823e3d90fd5b6024908451906332b2baa360e01b82523390820152fd5b50346101b657816003193601126101b65760025490516001600160a01b039091168152602090f35b50346101b657816003193601126101b6576020906005549051908152f35b50346101b657816003193601126101b657517f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03168152602090f35b50346101b657816003193601126101b65760209051620f42408152f35b50346101b657816003193601126101b657516002604360981b018152602090f35b508234610258576020366003190112610258576106bf6111d4565b6002546001600160a01b0380821693919233850361072d57169384156107175750506001600160a01b03191682176002557f820d8409eb2261e4f28201d3be272689ca6ebdd872f4fb34f71baea6cef203218380a380f35b51631cbbb84960e31b8152908101859052602490fd5b85516332b2baa360e01b81523381850152602490fd5b50346101b657816003193601126101b657600154905160089190911c6001600160a01b03168152602090f35b50829034610258576020366003190112610258577ff980d53d1bddd28d9ae609f333a2a294fa8f486a11bb8ddb03b71f5f17429011916020916107b06111d4565b6107b8611292565b82546001600160a01b0319166001600160a01b039190911690811790925551908152a180f35b50346101b657816003193601126101b657517f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03168152602090f35b5082346102585782600319360112610258575490516001600160a01b03909116815260209150f35b5082903461025857602036600319011261025857813591610868611292565b61271083116108a35750816020917fdc0410a296e1e33943a772020d333d5f99319d7fcad932a484c53889f7aaa2b19360055551908152a180f35b9051632104e43760e11b8152fd5b50346101b65760c03660031901126101b6576108cb6111d4565b6001600160a01b03602435818116908190036105af576044358281168091036105af57606435916084359460a4359460015460ff8116610b765760ff1916600190811790556002604360981b01803b15610b50578980918c8b518094819363784c3b3d60e11b83525af18015610b6c57908a91610b54575b505061094d611292565b807f00000000000000000000000000000000000000000000000000000000000000001691823b15610b505788516336b91f2b60e01b81529116818b0181905293929189908290602490829084905af18015610b4657908991610b32575b505091817ff980d53d1bddd28d9ae609f333a2a294fa8f486a11bb8ddb03b71f5f17429011927f5f14b62e234bc63bb125560da310357886b4b36dec230e1ce0418f9b70018a0c95948951938452602096878095a1610a07611292565b7f2c5d2d953f976871c35bb3c2634d694a32d34a4543c65fd93a8fcfe05d6eb2d9846bffffffffffffffffffffffff60a01b92808460035416176003558c51908152a1610a52611292565b8b5416178a558751908152a1610a66611292565b61271090818111610b225782817fdc0410a296e1e33943a772020d333d5f99319d7fcad932a484c53889f7aaa2b1926005558751908152a1610aa6611292565b828401808511610b0f5711610aff577fa9e360eddd0caab1562529f644d26909a6edb9589aa37de7be5a4c38399a34fb94955081818551610ae6816111ea565b858152015282600655816007558351928352820152a180f35b8351632104e43760e11b81528690fd5b634e487b7160e01b875260118852602487fd5b8551632104e43760e11b81528890fd5b610b3b9061121c565b6104ad5787386109aa565b88513d8b823e3d90fd5b8980fd5b610b5d9061121c565b610b68578838610943565b8880fd5b89513d8c823e3d90fd5b885163f92ee8a960e01b81528b90fd5b8234610be85780600319360112610be857610b9f611292565b60018054610100600160a81b0319811690915560009060081c6001600160a01b03167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08280a380f35b80fd5b50346101b657816003193601126101b65760035490516001600160a01b039091168152602090f35b50829034610258578260031936011261025857600254336001600160a01b0390911603610cc9578051633779e62960e21b815230928101929092526080826024816002604360981b015afa918215610cbf578392610c76575b6020838351908152f35b9091506080813d608011610cb7575b81610c9260809383611230565b8101031261025857600260606020830151920151101561025857602092509083610c6c565b3d9150610c85565b81513d85823e3d90fd5b6024925051906332b2baa360e01b82523390820152fd5b50346101b657816003193601126101b657602090516127108152f35b509034610be85780600319360112610be85760208251610d1b816111ea565b82815201528051610d2b816111ea565b60065490818152602060075491019081528251918252516020820152f35b50346101b65760203660031901126101b65760207f2c5d2d953f976871c35bb3c2634d694a32d34a4543c65fd93a8fcfe05d6eb2d991610d876111d4565b610d8f611292565b600380546001600160a01b0319166001600160a01b039290921691821790559051908152a180f35b508290346102585760203660031901126102585782610dd46111d4565b610ddc611292565b6001600160a01b037f000000000000000000000000000000000000000000000000000000000000000081169190823b15610460576024849283875195869485936336b91f2b60e01b855216809a8401525af18015610e7b57610e67575b507f5f14b62e234bc63bb125560da310357886b4b36dec230e1ce0418f9b70018a0c6020848451908152a180f35b610e709061121c565b610258578284610e39565b83513d84823e3d90fd5b5091346101b657816003193601126101b657610e9f611292565b825163430021db60e11b81523081830181815260208181019290925291939290918391908390869081906040010381856002604360981b015af19485156111095782956110da575b508480610efc575b5050508351928352820152f35b9091929350600554806110b0575b50506003546001600160a01b037f00000000000000000000000000000000000000000000000000000000000000008116918116823b156104b15787516340c10f1960e01b81526001600160a01b0390911684820190815260208101889052859082908190604001038183875af180156110935761109d575b508060035416803b156104b15784809160248a518094819363b212ddbb60e01b83528c8a8401525af1801561109357869291869161107a575b50506003541660248851809481936370a0823160e01b8352878301525afa92831561106f5792611040575b50811561102b5750620f4240830204907f60482527b9868ae5bae15388d5d7bad7c0aa3b5532bbbf6d2dfcccbf63ae4b068480518581528484820152a1388080610eef565b601290634e487b7160e01b6000525260246000fd5b9091508281813d8311611068575b6110588183611230565b810103126105af57519038610fe6565b503d61104e565b8651903d90823e3d90fd5b6110869192935061121c565b6104605784908438610fbb565b88513d87823e3d90fd5b6110a99094919461121c565b9238610f82565b825492955061271090820204916110d19083906001600160a01b03166112c1565b03923880610f0a565b9094508281813d8311611102575b6110f28183611230565b810103126101b657519338610ee7565b503d6110e8565b86513d84823e3d90fd5b50346101b657806003193601126101b6578235602435611131611292565b8082018083116111a05761271010611190577fa9e360eddd0caab1562529f644d26909a6edb9589aa37de7be5a4c38399a34fb9394508060208451611175816111ea565b8481520152816006558060075582519182526020820152a180f35b8251632104e43760e11b81528590fd5b634e487b7160e01b855260118652602485fd5b8390346101b657816003193601126101b65760209060ff6001541615158152f35b600435906001600160a01b03821682036105af57565b6040810190811067ffffffffffffffff82111761120657604052565b634e487b7160e01b600052604160045260246000fd5b67ffffffffffffffff811161120657604052565b90601f8019910116810190811067ffffffffffffffff82111761120657604052565b3d1561128d573d9067ffffffffffffffff82116112065760405191611281601f8201601f191660200184611230565b82523d6000602084013e565b606090565b60015460081c6001600160a01b031633036112a957565b60405163118cdaa760e01b8152336004820152602490fd5b8147106112fe576000918291829182916001600160a01b03165af16112e4611252565b50156112ec57565b604051630a12f52160e11b8152600490fd5b60405163cd78605960e01b8152306004820152602490fdfea2646970667358221220402ad7a90360cd493ef8ae7520a023ebb0598180ba96cddc7aa1cb6820c4741264736f6c63430008180033000000000000000000000000cae21365145c467f8957607ae364fb29ee073209000000000000000000000000cae21365145c467f8957607ae364fb29ee0732090000000000000000000000004e06dc746f8d3ab15bc7522e2b3a1ed087f146170000000000000000000000002fc95838c71e76ec69ff817983bff17c710f34e0";

    public static final String FUNC_CLAIM_ETH_YIELD = "claimETHYield";

    public static final Event CLAIMETHYIELD_EVENT = new Event("ClaimETHYield", 
            Arrays.<TypeReference<?>>asList(new TypeReference<Uint256>() {}, new TypeReference<Uint256>() {}));

    protected OutETHVault(String contractAddress, Web3j web3j, TransactionManager transactionManager, ContractGasProvider contractGasProvider) {
        super(BINARY, contractAddress, web3j, transactionManager, contractGasProvider);
    }

    public static List<ClaimETHYieldEventResponse> getClaimETHYieldEvents(TransactionReceipt transactionReceipt) {
        List<Contract.EventValuesWithLog> valueList = staticExtractEventParametersWithLog(CLAIMETHYIELD_EVENT, transactionReceipt);
        ArrayList<ClaimETHYieldEventResponse> responses = new ArrayList<ClaimETHYieldEventResponse>(valueList.size());
        for (Contract.EventValuesWithLog eventValues : valueList) {
            ClaimETHYieldEventResponse typedResponse = new ClaimETHYieldEventResponse();
            typedResponse.log = eventValues.getLog();
            typedResponse.amount = (BigInteger) eventValues.getNonIndexedValues().get(0).getValue();
            typedResponse.dayRate = (BigInteger) eventValues.getNonIndexedValues().get(1).getValue();
            responses.add(typedResponse);
        }
        return responses;
    }

    public static ClaimETHYieldEventResponse getClaimETHYieldEventFromLog(Log log) {
        Contract.EventValuesWithLog eventValues = staticExtractEventParametersWithLog(CLAIMETHYIELD_EVENT, log);
        ClaimETHYieldEventResponse typedResponse = new ClaimETHYieldEventResponse();
        typedResponse.log = log;
        typedResponse.amount = (BigInteger) eventValues.getNonIndexedValues().get(0).getValue();
        typedResponse.dayRate = (BigInteger) eventValues.getNonIndexedValues().get(1).getValue();
        return typedResponse;
    }

    public Flowable<ClaimETHYieldEventResponse> claimETHYieldEventFlowable(EthFilter filter) {
        return web3j.ethLogFlowable(filter).map(OutETHVault::getClaimETHYieldEventFromLog);
    }

    public Flowable<ClaimETHYieldEventResponse> claimETHYieldEventFlowable(DefaultBlockParameter startBlock, DefaultBlockParameter endBlock) {
        EthFilter filter = new EthFilter(startBlock, endBlock, getContractAddress());
        filter.addSingleTopic(EventEncoder.encode(CLAIMETHYIELD_EVENT));
        return claimETHYieldEventFlowable(filter);
    }

    public RemoteFunctionCall<TransactionReceipt> claimETHYield() {
        final Function function = new Function(
                FUNC_CLAIM_ETH_YIELD,
                Arrays.<Type>asList(), 
                Collections.<TypeReference<?>>emptyList());
        return executeRemoteCallTransaction(function);
    }

    public static OutETHVault load(String contractAddress, Web3j web3j, TransactionManager transactionManager, ContractGasProvider contractGasProvider) {
        return new OutETHVault(contractAddress, web3j, transactionManager, contractGasProvider);
    }

    public static class ClaimETHYieldEventResponse extends BaseEventResponse {
        public BigInteger amount;

        public BigInteger dayRate;
    }
}
