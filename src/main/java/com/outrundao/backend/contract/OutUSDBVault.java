package com.outrundao.backend.contract;

import io.reactivex.Flowable;
import org.web3j.abi.EventEncoder;
import org.web3j.abi.TypeReference;
import org.web3j.abi.datatypes.Event;
import org.web3j.abi.datatypes.Function;
import org.web3j.abi.datatypes.Type;
import org.web3j.abi.datatypes.generated.Uint256;
import org.web3j.protocol.Web3j;
import org.web3j.protocol.core.DefaultBlockParameter;
import org.web3j.protocol.core.RemoteFunctionCall;
import org.web3j.protocol.core.methods.request.EthFilter;
import org.web3j.protocol.core.methods.response.BaseEventResponse;
import org.web3j.protocol.core.methods.response.Log;
import org.web3j.protocol.core.methods.response.TransactionReceipt;
import org.web3j.tx.Contract;
import org.web3j.tx.TransactionManager;
import org.web3j.tx.gas.ContractGasProvider;

import java.math.BigInteger;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;

@SuppressWarnings("rawtypes")
public class OutUSDBVault extends Contract {
    public static final String BINARY = "60c0346200021b57601f620017b938819003918201601f19168301926001600160401b0392909183851183861017620002205781608092849260409788528339810103126200021b57620000538162000236565b620000616020830162000236565b906200007d60606200007587860162000236565b940162000236565b936000916001835560018060a01b03938482168015620002035760018054610100600160a81b03198116600895861b610100600160a81b03161790915589519387939291901c83167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08780a316908115620001ed5750600280546001600160a01b031981168317909155875194167f820d8409eb2261e4f28201d3be272689ca6ebdd872f4fb34f71baea6cef203218480a3734300000000000000000000000000000000000002803b15620001e95783600481858094634e606c4760e01b83525af18015620001df57620001b8575b50505060a0526080525161156d90816200024c82396080518181816106dc01528181610caf015261112f015260a051818181610167015281816103b9015281816107ee015261122a0152f35b8211620001cb575083523880806200016c565b634e487b7160e01b81526041600452602490fd5b86513d84823e3d90fd5b8280fd5b631cbbb84960e31b815260048101849052602490fd5b8851631e4fbdf760e01b815260048101869052602490fd5b600080fd5b634e487b7160e01b600052604160045260246000fd5b51906001600160a01b03821682036200021b5756fe6080604081815260048036101561001557600080fd5b600092833560e01c908163158ef93e146112fb5750806324679d3c14611259578063297ee9941461121557806331a0edec146111f357806336b91f2b1461110257806337f7ca35146110935780634847cdc81461104657806359e741d21461102957806364e5e3b114610f5d578063715018a614610ef8578063728cdbca14610c0c578063787dce3d14610ba55780637f753de614610b7e578063884957e614610b105780638da5cb5b14610ae35780638f7fe49a14610a4557806397d7577614610a23578063a4951daf14610729578063a5626d2c1461070b578063ac866a32146106c7578063b0e21e8a146106a8578063b5e4a1c41461067f578063c4a1810b14610656578063cd2002f514610565578063e0232b4214610253578063f2fde38b146101b65763f3fef3a31461014c57600080fd5b346101b257816003193601126101b25761016461131c565b917f00000000000000000000000000000000000000000000000000000000000000006001600160a01b031633036101a557836101a2602435856113c9565b80f35b51630782484160e21b8152fd5b8280fd5b50346101b25760203660031901126101b2576101d061131c565b6101d861139a565b6001600160a01b0381811693909290841561023d57505060018054610100600160a81b03198116600893841b610100600160a81b031617909155901c167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0600080a380f35b51631e4fbdf760e01b8152908101859052602490fd5b5090346101b25760603660031901126101b25761026e61131c565b906024908135906044359267ffffffffffffffff9586851161047f573660238601121561047f578481013596871161047f573682888701011161047f576002885414610557576002885583158015610546575b6105385782516370a0823160e01b808252308383015260209690916022602160991b01918b9089838881875afa9283156104fb578293610505575b50610307898c6113c9565b6001600160a01b039a8b169b8c3b156101b25787918d8b8560848b868f97849851998a9889978895634963710d60e01b87523390870152828601526060604486015282606486015201848401378181018301849052601f01601f191681010301925af180156104fb576104e3575b50508761271093846006548a0204946007548a020496885180958193825230898301525afa9182156104d957859184918d946104a0575b50010111610491578890877f00000000000000000000000000000000000000000000000000000000000000001690886003541690823b1561048d5786516340c10f1960e01b81526001600160a01b0390921685830190815260208101919091529091839183919082908490829060400103925af1801561048357610467575b5050907f134bde118562a60dcf2d8c52965f586e25cf88a371592e44b78c4aa03bcbac849561045b9254166113c9565b51908152a26001815580f35b61047390939293611364565b61047f5790873861042b565b8780fd5b85513d84823e3d90fd5b8380fd5b5082516359c16ac760e01b8152fd5b92509250508781813d83116104d2575b6104ba8183611378565b810103126104cd578285915192386103ac565b600080fd5b503d6104b0565b86513d8d823e3d90fd5b6104ec90611364565b6104f7578a38610375565b8a80fd5b88513d84823e3d90fd5b8a809294508193503d8311610531575b61051f8183611378565b810103126104cd578b905191386102fc565b503d610515565b825163af458c0760e01b8152fd5b506001600160a01b038616156102c1565b8251633ee5aeb560e01b8152fd5b5091903461065257602092836003193601126101b25761058361131c565b6002546001600160a01b039190339083160361063c57835163662aa11d60e01b815230938101939093521660248201819052908481604481876002604360981b015af19384156106315793610602575b507fd68ad86d3ece5caa9dec4dd80d3ced368f81b77895c4c9c4923a5f938748feb9848351858152a251908152f35b9092508381813d831161062a575b61061a8183611378565b810103126104cd575191386105d3565b503d610610565b8351903d90823e3d90fd5b83516332b2baa360e01b81523381850152602490fd5b5080fd5b50503461065257816003193601126106525760035490516001600160a01b039091168152602090f35b50503461065257816003193601126106525760025490516001600160a01b039091168152602090f35b5050346106525781600319360112610652576020906005549051908152f35b505034610652578160031936011261065257517f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03168152602090f35b50503461065257816003193601126106525760209051620f42408152f35b5082903461065257816003193601126106525761074461139a565b825163e12f3a6160e01b815230818301526022602160991b0192916020918391908381602481895afa908115610a195783916109ec575b50809581610792575b505050508351928352820152f35b8751635569f64b60e11b815230818501908152602081018490529596509394929391928691839182908890829060400103925af180156109e2579085916109b9575b50506005548061098f575b50506003546001600160a01b037f00000000000000000000000000000000000000000000000000000000000000008116918116823b156109775787516340c10f1960e01b81526001600160a01b0390911684820190815260208101889052859082908190604001038183875af1801561096d5790859161097b575b50508060035416803b156109775784809160248a518094819363b212ddbb60e01b83528c8a8401525af1801561096d578692918691610954575b50506003541660248851809481936370a0823160e01b8352878301525afa928315610949579261091a575b5081156109055750620f4240830204907faa03eea2862856316c10bf82867a62736c5aa8c18faf9a5db6677c0d03441c188480518581528484820152a184808080610784565b601290634e487b7160e01b6000525260246000fd5b9091508281813d8311610942575b6109328183611378565b810103126104cd575190856108bf565b503d610928565b8651903d90823e3d90fd5b61096091929350611364565b61048d5784908489610894565b88513d87823e3d90fd5b8480fd5b61098490611364565b61048d57838861085a565b825492955061271090820204916109b09083906001600160a01b03166113c9565b039285806107df565b813d83116109db575b6109cc8183611378565b810103126104cd5783876107d4565b503d6109c2565b87513d86823e3d90fd5b90508381813d8311610a12575b610a038183611378565b810103126104cd57518761077b565b503d6109f9565b87513d85823e3d90fd5b505034610652578160031936011261065257516002604360981b018152602090f35b50346101b25760203660031901126101b257610a5f61131c565b6002546001600160a01b03808216939192338503610acd5716938415610ab75750506001600160a01b03191682176002557f820d8409eb2261e4f28201d3be272689ca6ebdd872f4fb34f71baea6cef203218380a380f35b51631cbbb84960e31b8152908101859052602490fd5b85516332b2baa360e01b81523381850152602490fd5b505034610652578160031936011261065257600154905160089190911c6001600160a01b03168152602090f35b5090346101b25760203660031901126101b2577ff980d53d1bddd28d9ae609f333a2a294fa8f486a11bb8ddb03b71f5f1742901191602091610b5061131c565b610b5861139a565b82546001600160a01b0319166001600160a01b039190911690811790925551908152a180f35b50346101b257826003193601126101b2575490516001600160a01b03909116815260209150f35b5090346101b25760203660031901126101b257813591610bc361139a565b6127108311610bfe5750816020917fdc0410a296e1e33943a772020d333d5f99319d7fcad932a484c53889f7aaa2b19360055551908152a180f35b9051632104e43760e11b8152fd5b509190346106525760c036600319011261065257610c2861131c565b6024356001600160a01b0381811692918390036104cd576044358181168091036104cd57606435906084359460a4359460015460ff8116610ee85760ff1916600190811790558751631a33757d60e01b815260028b8201526020959086816024818e6022602160991b015af18015610ede57908791610eb5575b5050610cac61139a565b807f00000000000000000000000000000000000000000000000000000000000000001691823b156104f75789516336b91f2b60e01b81529116818c01819052918a908290602490829084905af18015610eab57869392918b91610e8c575b50509280917f5f14b62e234bc63bb125560da310357886b4b36dec230e1ce0418f9b70018a0c847ff980d53d1bddd28d9ae609f333a2a294fa8f486a11bb8ddb03b71f5f17429011968c51908152a1610d6161139a565b7feb08b5d4d604e343426b100d11790bb87f8cc880eefbfc9f88e2c7ff56b7b656846bffffffffffffffffffffffff60a01b92808460035416176003558c51908152a1610dac61139a565b8b5416178a558751908152a1610dc061139a565b61271090818111610e7c5782817fdc0410a296e1e33943a772020d333d5f99319d7fcad932a484c53889f7aaa2b1926005558751908152a1610e0061139a565b828401808511610e695711610e59577fa9e360eddd0caab1562529f644d26909a6edb9589aa37de7be5a4c38399a34fb94955081818551610e4081611332565b858152015282600655816007558351928352820152a180f35b8351632104e43760e11b81528690fd5b634e487b7160e01b875260118852602487fd5b8551632104e43760e11b81528890fd5b610e999192939450611364565b610ea7579084918938610d0a565b8880fd5b89513d8c823e3d90fd5b813d8311610ed7575b610ec88183611378565b810103126104cd578538610ca2565b503d610ebe565b8a513d8d823e3d90fd5b885163f92ee8a960e01b81528b90fd5b8334610f5a5780600319360112610f5a57610f1161139a565b60018054610100600160a81b0319811690915560009060081c6001600160a01b03167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08280a380f35b80fd5b5090346101b257826003193601126101b257600254336001600160a01b0390911603611012578051633779e62960e21b815230928101929092526080826024816002604360981b015afa918215611008578392610fbf575b6020838351908152f35b9091506080813d608011611000575b81610fdb60809383611378565b810103126101b25760026060602083015192015110156101b257602092509038610fb5565b3d9150610fce565b81513d85823e3d90fd5b6024925051906332b2baa360e01b82523390820152fd5b505034610652578160031936011261065257602090516127108152f35b828434610f5a5780600319360112610f5a576020825161106581611332565b8281520152805161107581611332565b60065490818152602060075491019081528251918252516020820152f35b5050346106525760203660031901126106525760207feb08b5d4d604e343426b100d11790bb87f8cc880eefbfc9f88e2c7ff56b7b656916110d261131c565b6110da61139a565b600380546001600160a01b0319166001600160a01b039290921691821790559051908152a180f35b5090346101b25760203660031901126101b25761111d61131c565b61112561139a565b6001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000811691859190833b156101b25760249083865195869485936336b91f2b60e01b85521680998401525af180156111e9576111b1575b507f5f14b62e234bc63bb125560da310357886b4b36dec230e1ce0418f9b70018a0c9160209151908152a180f35b91602091936111e07f5f14b62e234bc63bb125560da310357886b4b36dec230e1ce0418f9b70018a0c94611364565b93915091611183565b82513d86823e3d90fd5b505034610652578160031936011261065257516022602160991b018152602090f35b505034610652578160031936011261065257517f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03168152602090f35b50919034610652578060031936011261065257823560243561127961139a565b8082018083116112e857612710106112d8577fa9e360eddd0caab1562529f644d26909a6edb9589aa37de7be5a4c38399a34fb93945080602084516112bd81611332565b8481520152816006558060075582519182526020820152a180f35b8251632104e43760e11b81528590fd5b634e487b7160e01b855260118652602485fd5b84903461065257816003193601126106525760209060ff6001541615158152f35b600435906001600160a01b03821682036104cd57565b6040810190811067ffffffffffffffff82111761134e57604052565b634e487b7160e01b600052604160045260246000fd5b67ffffffffffffffff811161134e57604052565b90601f8019910116810190811067ffffffffffffffff82111761134e57604052565b60015460081c6001600160a01b031633036113b157565b60405163118cdaa760e01b8152336004820152602490fd5b60405163a9059cbb60e01b602082019081526001600160a01b0392909216602482015260448082019390935291825290601f19611407606483611378565b6000808093516022602160991b019582875af13d156114c5573d67ffffffffffffffff81116114b15790611459929161144b602060405194601f8401160184611378565b82523d84602084013e6114ce565b908151918215159283611489575b5050506114715750565b60249060405190635274afe760e01b82526004820152fd5b819293509060209181010312610652576020015190811591821503610f5a5750388080611467565b634e487b7160e01b84526041600452602484fd5b61145991506060905b9091906114f757508051156114e557805190602001fd5b604051630a12f52160e11b8152600490fd5b9080511580611527575b6115085790565b604051639996b31560e01b81526022602160991b016004820152602490fd5b506022602160991b013b1561150156fea264697066735822122029624af3df6965aae7dba04eca9636b09a1f1cd450a26304048e0c83c8094eec64736f6c63430008180033000000000000000000000000cae21365145c467f8957607ae364fb29ee073209000000000000000000000000cae21365145c467f8957607ae364fb29ee073209000000000000000000000000671540e1569b8e82605c3eea5939d326c4eda4570000000000000000000000002fc95838c71e76ec69ff817983bff17c710f34e0";

    public static final String FUNC_CLAIM_USDB_YIELD = "claimUSDBYield";

    public static final Event CLAIMUSDBYIELD_EVENT = new Event("ClaimUSDBYield", 
            Arrays.<TypeReference<?>>asList(new TypeReference<Uint256>() {}, new TypeReference<Uint256>() {}));

    protected OutUSDBVault(String contractAddress, Web3j web3j, TransactionManager transactionManager, ContractGasProvider contractGasProvider) {
        super(BINARY, contractAddress, web3j, transactionManager, contractGasProvider);
    }

    public static List<ClaimUSDBYieldEventResponse> getClaimUSDBYieldEvents(TransactionReceipt transactionReceipt) {
        List<Contract.EventValuesWithLog> valueList = staticExtractEventParametersWithLog(CLAIMUSDBYIELD_EVENT, transactionReceipt);
        ArrayList<ClaimUSDBYieldEventResponse> responses = new ArrayList<ClaimUSDBYieldEventResponse>(valueList.size());
        for (Contract.EventValuesWithLog eventValues : valueList) {
            ClaimUSDBYieldEventResponse typedResponse = new ClaimUSDBYieldEventResponse();
            typedResponse.log = eventValues.getLog();
            typedResponse.amount = (BigInteger) eventValues.getNonIndexedValues().get(0).getValue();
            typedResponse.dayRate = (BigInteger) eventValues.getNonIndexedValues().get(1).getValue();
            responses.add(typedResponse);
        }
        return responses;
    }

    public static ClaimUSDBYieldEventResponse getClaimUSDBYieldEventFromLog(Log log) {
        Contract.EventValuesWithLog eventValues = staticExtractEventParametersWithLog(CLAIMUSDBYIELD_EVENT, log);
        ClaimUSDBYieldEventResponse typedResponse = new ClaimUSDBYieldEventResponse();
        typedResponse.log = log;
        typedResponse.amount = (BigInteger) eventValues.getNonIndexedValues().get(0).getValue();
        typedResponse.dayRate = (BigInteger) eventValues.getNonIndexedValues().get(1).getValue();
        return typedResponse;
    }

    public Flowable<ClaimUSDBYieldEventResponse> claimUSDBYieldEventFlowable(EthFilter filter) {
        return web3j.ethLogFlowable(filter).map(OutUSDBVault::getClaimUSDBYieldEventFromLog);
    }

    public Flowable<ClaimUSDBYieldEventResponse> claimUSDBYieldEventFlowable(DefaultBlockParameter startBlock, DefaultBlockParameter endBlock) {
        EthFilter filter = new EthFilter(startBlock, endBlock, getContractAddress());
        filter.addSingleTopic(EventEncoder.encode(CLAIMUSDBYIELD_EVENT));
        return claimUSDBYieldEventFlowable(filter);
    }

    public RemoteFunctionCall<TransactionReceipt> claimUSDBYield() {
        final Function function = new Function(
                FUNC_CLAIM_USDB_YIELD,
                Arrays.<Type>asList(), 
                Collections.<TypeReference<?>>emptyList());
        return executeRemoteCallTransaction(function);
    }

    public static OutUSDBVault load(String contractAddress, Web3j web3j, TransactionManager transactionManager, ContractGasProvider contractGasProvider) {
        return new OutUSDBVault(contractAddress, web3j, transactionManager, contractGasProvider);
    }

    public static class ClaimUSDBYieldEventResponse extends BaseEventResponse {
        public BigInteger amount;

        public BigInteger dayRate;
    }
}
